let windowObjectReference=null;function openRequestedTab(e){if(null===windowObjectReference||windowObjectReference.closed){const t=`${e}?theme=${"dark"===window.UIConfig.theme?"dark":"light"}`,n="scrollbars=no,resizable=yes,status=no,location=no,toolbar=no,menubar=no,width=0,height=0,left=-1000,top=-1000";windowObjectReference=window.open(t,"Sakila DB ER Diagram",n)}else windowObjectReference.focus()}function switchTheme(e){const t=e.target.checked?"dark":"light";window.sql_editor&&window.sql_editor.setTheme("dark"===t?"ace/theme/github_dark":"ace/theme/xcode"),document.documentElement.setAttribute("data-theme",t),window.UIConfig.theme=t,saveUIConfig(),document.getElementById("yandex_rtb_R-A-4716552-2")&&Ya.Context.AdvManager.render({blockId:"R-A-4716552-2",renderTo:"yandex_rtb_R-A-4716552-2",darkTheme:"dark"===window.UIConfig.theme}),document.getElementById("yandex_rtb_R-A-4716552-4")&&Ya.Context.AdvManager.render({blockId:"R-A-4716552-4",renderTo:"yandex_rtb_R-A-4716552-4",darkTheme:"dark"===window.UIConfig.theme}),document.getElementById("yandex_rtb_R-A-4716552-7")&&window.yaContextCb.push(()=>{Ya.Context.AdvManager.render({blockId:"R-A-4716552-7",renderTo:"yandex_rtb_R-A-4716552-7",darkTheme:"dark"===window.UIConfig.theme})})}function formatCode(){const e=ace.require("ace/ext/beautify"),t=window.sql_editor.session;e.beautify(t)}function setLoader(e){return document.getElementById(e).innerHTML='<div class="loader">Loading...</div>'}function showToast(e,t){const n=document.getElementById("toast");"error"!==e&&(n.classList.remove("error"),e="info"),n.innerText=t||"...",n.classList.remove("info"),n.classList.add(e),n.classList.toggle("visible");setTimeout(function(){n.classList.toggle("visible")},"error"===e?5e3:2e3)}function loadMenu(e){fetch(`/${lang}/menu?questionnire=${e}`,{method:"GET",mode:"cors",cache:"default",credentials:"same-origin"}).then(async e=>{if(!e.ok)throw Error("Something went wrong.");return await e.text()}).then(t=>{document.getElementById("menu").innerHTML=t,window.UIConfig.questionnire=e,saveUIConfig(),setMenuEventListeners()}).catch(e=>{console.log(e)})}function copyCode(e){const t=window.sql_editor;navigator.clipboard&&navigator.clipboard.writeText(t.getValue()),showToast("info",e)}function clearEditor(){const e=window.sql_editor;e.setValue(""),e.focus(),e.session.selection.clearSelection()}function toggleLoginWindow(){document.getElementById("login-menu").classList.toggle("hidden")}function toggleMobileMenu(){document.getElementById("mobileMenuDropdown").classList.toggle("hidden")}function toggleAchievements(e){const t=document.getElementById("achievements-popup");setLoader("achievements-popup"),t.classList.toggle("hidden"),fetch(`/${e}/user/achievements`).then(async e=>{if(!e.ok)throw Error("Something went wrong.");return await e.text()}).then(e=>{t.innerHTML=e}).catch(e=>{t.innerHTML="<p>Something went wrong.</p>"})}function jsonToTable(e){let t="",n=0;try{t="<table class='result-table'><tr><th></th><th>"+e.headers.map(e=>e.header).join("</th><th>")+"</th></tr>";for(let o of e.data)t+="<tr><td>"+ ++n+"</td><td>"+o.map(e=>null===e?"[null]":e).join("</td><td>")+"</td></tr>";t+="</table>"}catch(e){t="Something went wrong. Please review your query and try again."}return t}function errorToTable(e){return`<span class="sql_error">${e.error}</span>`}function getHelp(e,t){setLoader("code-result"),fetch(`/${e}/question/${t}/query-help`,{method:"GET",mode:"cors",cache:"default",credentials:"same-origin"}).then(async e=>{if(!e.ok)throw Error("Something went wrong.");return await e.text()}).then(e=>{document.getElementById("code-result").innerHTML=e})}function runQuery(e,t){setLoader("code-result");let n=new FormData;n.append("query",window.sql_editor.getValue()),fetch(`/${e}/question/${t}/query-run`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:n}).then(async e=>{if(!e.ok)throw Error("Something went wrong.");return await e.text()}).then(JSON.parse).then(e=>{let t="✓ (Done)";if(e&&e[0]){const n=e[0];t=n.error?errorToTable(n):jsonToTable(n)}document.getElementById("code-result").innerHTML=t}).catch(e=>{document.getElementById("code-result").innerHTML='Something went wrong. Please review your query and try again or contact us by email: <a href="mailto:support@sqlize.online">support@sqlize.online</a>.'})}function checkAnswers(e,t){setLoader("code-result");const n=[...document.querySelectorAll("input[name=answers]:checked")].reduce((e,t)=>(e.push(parseInt(t.value)),e),[]).toSorted();let o=new FormData;o.append("answers",JSON.stringify(n)),fetch(`/${e}/question/${t}/check-answers`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:o}).then(async e=>(e.ok&&e.ok&&document.getElementById("nextTaskBtn")&&(document.getElementById("nextTaskBtn").classList.toggle("hidden"),setTimeout(()=>{document.getElementById("main3").scrollTo({top:document.getElementById("nextTaskBtn").offsetTop,behavior:"smooth"})},300)),await e.text())).then(e=>{document.getElementById("code-result").innerHTML=e}).catch(e=>{document.getElementById("code-result").innerHTML="Something went wrong. Please review your query and try again."})}function testQuery(e,t){setLoader("code-result");let n=new FormData;n.append("query",window.sql_editor.getValue()),fetch(`/${e}/question/${t}/query-test`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:n}).then(async e=>(e.ok&&document.getElementById("nextTaskBtn")&&(document.getElementById("nextTaskBtn").classList.toggle("hidden"),setTimeout(()=>{document.getElementById("main3")?document.getElementById("main3").scrollTo({top:document.getElementById("nextTaskBtn").offsetTop,behavior:"smooth"}):window.scrollTo({top:document.getElementById("db-description").offsetTop-window.outerHeight,behavior:"smooth"})},300)),await e.text())).then(e=>{document.getElementById("code-result").innerHTML=e}).catch(e=>{document.getElementById("code-result").innerHTML='Something went wrong. Please review your query and try again or contact us by email: <a href="mailto:support@sqlize.online">support@sqlize.online</a>.'})}function toggleFavorites(e,t){let n=new FormData;fetch(`/${e}/question/${t}/favorite`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:n}).then(async e=>{if(e.ok&&document.getElementById("favoriteStar")){showToast("info",await e.text()),document.getElementById("favoriteStar").classList.toggle("favored")}}).catch(e=>{showToast("error","Something went wrong. Please ask admin for help.")})}function checkSolution(e){setLoader("code-result");let t=new FormData;if(window.sql_editor&&t.append("query",window.sql_editor.getValue()),document.getElementById("answers-list")){const e=[...document.querySelectorAll("input[name=answers]:checked")].reduce((e,t)=>(e.push(parseInt(t.value)),e),[]).toSorted();t.append("answers",JSON.stringify(e))}fetch(e,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:t}).then(async e=>{if(e.ok)document.getElementById("checkSolutionBtn")&&document.getElementById("checkSolutionBtn").classList.toggle("hidden"),document.getElementById("nextQuestionBtn")&&document.getElementById("nextQuestionBtn").classList.toggle("hidden");else{let e=document.getElementById("attemptsCount").innerText;parseInt(e)>0&&(document.getElementById("attemptsCount").innerText=(e-1).toString())}return await e.text()}).then(e=>{document.getElementById("code-result").innerHTML=e}).catch(e=>{document.getElementById("code-result").innerHTML="Something went wrong. Please review your query and try again."})}function showMySolutions(e){showSolutions(e,"my")}function showOthersSolutions(e){showSolutions(e,"others")}function showSolutions(e,t){document.getElementById("right-panel").innerHTML='<div id="pre-loader" style="width: 21vw;"></div>',setLoader("pre-loader");const n="my"===t?`/${lang}/question/${e}/my-solutions`:`/${lang}/question/${e}/solutions`;fetch(n,{method:"GET",mode:"cors",cache:"default",credentials:"same-origin"}).then(async e=>{if(!e.ok)throw Error("Something went wrong.");return await e.text()}).then(e=>{document.getElementById("right-panel").innerHTML=e}).then(()=>{[...document.getElementsByClassName("solution-block")].map(e=>{ace.edit(e.id,{mode:"ace/mode/mysql",dragEnabled:!1,useWorker:!1,readOnly:!0}).setTheme("dark"===window.UIConfig.theme?"ace/theme/github_dark":"ace/theme/xcode")})}).catch(e=>{document.getElementById("right-panel").innerHTML="Something went wrong."})}function solutionUpdate(e,t){return fetch(`/${lang}/solution/${e}/${t}`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin"}).then(async e=>{if(e.ok){showToast("info",await e.text())}}).catch(e=>{showToast("error","Something went wrong. Please ask admin for help.")})}function solutionLike(e){return solutionUpdate(e,"like").then(()=>{[...document.getElementById(`solution-likes-${e}`).children].map(e=>e.classList.toggle("hidden")),document.getElementById(`solution-likes-count-${e}`).innerText=parseInt(document.getElementById(`solution-likes-count-${e}`).innerText)+1})}function solutionUnlike(e){return solutionUpdate(e,"unlike").then(()=>{[...document.getElementById(`solution-likes-${e}`).children].map(e=>e.classList.toggle("hidden")),document.getElementById(`solution-likes-count-${e}`).innerText=parseInt(document.getElementById(`solution-likes-count-${e}`).innerText)-1})}function setCookie(e,t,n){let o="";if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),o="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}function hideWelcome(e){e?setCookie("HideWelcome","1",365):setCookie("HideWelcome","",-1)}function solutionReport(e,t,n){solutionUpdate(n,"report").then(()=>showOthersSolutions(t))}function solutionDelete(e,t,n){return fetch(`/${e}/solution/${n}/delete`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin"}).then(async e=>{if(e.ok){showToast("info",await e.text())}}).then(()=>showMySolutions(t)).catch(e=>{showToast("error","Something went wrong. Please ask admin for help.")})}function solutionRun(e,t,n){const o=ace.edit(`solution-${n}`).getValue();return window.sql_editor.setValue(o),runQuery(e,t)}function rateQuestion(e,t){let n=new FormData;n.append("rate",t),fetch(`/${lang}/question/${e}/rate`,{method:"POST",mode:"cors",cache:"default",credentials:"same-origin",body:n}).then(async e=>{if(e.ok){showToast("info",await e.text())}}).catch(e=>{showToast("error","Something went wrong. Please ask admin for help.")})}function toggleSolvedTasks(e){return[...document.getElementsByClassName("eye-btn")].map(e=>e.classList.toggle("hidden")),[...document.getElementsByClassName("question-link solved")].map(e=>{e.parentNode.classList.toggle("invisible")}),window.UIConfig.hideSolvedTasks=!window.UIConfig.hideSolvedTasks,saveUIConfig(),!1}function toggleNotFavoritsTasks(e){return document.getElementById("toggleNotFavoritTasks").classList.toggle("favored"),[...document.getElementsByClassName("question-link solved")].map(e=>{e.parentNode.classList.toggle("invisible")}),window.UIConfig.hidenotFavoredTasks=!window.UIConfig.hidenotFavoredTasks,saveUIConfig(),!1}function toggleInfoPanel(){return document.getElementsByClassName("right")[0].classList.toggle("hidden"),document.getElementsByClassName("main")[0].classList.toggle("wide"),[...document.getElementsByClassName("splitter")[0].children].map(e=>e.classList.toggle("hidden")),window.UIConfig.hideInfoPanel=!window.UIConfig.hideInfoPanel,saveUIConfig(),!1}function scrollQuestionPanel(){const e=document.getElementsByClassName("panel active")[0],t=document.getElementsByClassName("current-question")[0];e&&t&&(e.scrollTop=t.offsetTop-e.offsetTop)}function openLinkedinLoginPopUp(){window.open(`https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=77scnm5m8z804e&redirect_uri=${window.location.protocol}//${window.location.host}/login/linkedin/&state=SignupAuth&scope=openid%20email%20profile`,"LinkedIn Login",`scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=530,height=950,left=${(window.outerWidth-530)/2},top=${(window.outerHeight-950)/2}`)}function openGitHubLoginPopUp(){window.open(`https://github.com/login/oauth/authorize?client_id=9a1910d2a6c658fdffc3&redirect_uri=${window.location.protocol}//${window.location.host}/login/github/&scope=user`,"GitHub Login",`scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=530,height=950,left=${(window.outerWidth-530)/2},top=${(window.outerHeight-950)/2}`)}function openVKLoginPopUp(){const e=`uuid=29890eb2-6a16-0613-190f-250e54537e18&app_id=51931966&response_type=silent_token&redirect_uri=${`https://sqltest.online/login/vk/?lang=${lang}`}&redirect_state=login`;window.open(`https://id.vk.com/auth?${e}`,"VK Login",`scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=530,height=950,left=${(window.outerWidth-530)/2},top=${(window.outerHeight-950)/2}`)}function openEmailLoginPopUp(){document.getElementById("emailLoginPopup").style.display="flex",document.getElementById("loginFormContainer").style.display="block",document.getElementById("registerFormContainer").style.display="none"}function closeEmailLoginPopUp(){document.getElementById("emailLoginPopup").style.display="none",document.getElementById("emailLoginForm").reset(),document.getElementById("emailRegisterForm").reset(),hideLoginError(),hideRegisterError()}function showLoginError(e){const t=document.getElementById("loginErrorMessage");t.textContent=e,t.style.display="block"}function hideLoginError(){const e=document.getElementById("loginErrorMessage");e.style.display="none",e.textContent=""}function showRegisterError(e){const t=document.getElementById("registerErrorMessage");t.textContent=e,t.style.display="block"}function hideRegisterError(){const e=document.getElementById("registerErrorMessage");e.style.display="none",e.textContent=""}function switchToRegister(e){e.preventDefault(),hideLoginError(),document.getElementById("loginFormContainer").style.display="none",document.getElementById("registerFormContainer").style.display="block"}function switchToLogin(e){e.preventDefault(),hideRegisterError(),document.getElementById("registerFormContainer").style.display="none",document.getElementById("loginFormContainer").style.display="block"}function handleEmailLogin(e){e.preventDefault(),hideLoginError();const t=document.getElementById("loginEmail").value,n=document.getElementById("loginPassword").value;fetch("/login/password/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({email:t,password:n,ajax:1,lang:lang}).toString()}).then(e=>e.json()).then(e=>{e.status&&"ok"===e.status?window.location.reload():showLoginError(e.message||"Login failed. Please check your credentials.")}).catch(e=>{console.error("Error:",e),showLoginError("An error occurred during login. Please try again.")})}function handleEmailRegister(e){e.preventDefault(),hideRegisterError();const t=document.getElementById("registerName").value,n=document.getElementById("registerEmail").value,o=document.getElementById("registerPassword").value;if(o!==document.getElementById("registerPasswordConfirm").value)return void showRegisterError("Passwords do not match!");fetch(`/${lang}/register/`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({full_name:t,email:n,password:o,ajax:1,lang:lang}).toString()}).then(e=>e.json()).then(t=>{t.status&&"ok"===t.status?switchToLogin(e):showRegisterError(t.message||"Registration failed. Please try again.")}).catch(e=>{console.error("Error:",e),showRegisterError("An error occurred during registration. Please try again.")})}function openGoogleLoginPopUp(){const e={response_type:"code",client_id:"340274762951-1d5m1pb8p9i2bhjbtuc4p8q9gveuk2ug.apps.googleusercontent.com",redirect_uri:`${window.location.protocol}//${window.location.host}/login/google/`,scope:"openid email",state:""};window.open("https://accounts.google.com/o/oauth2/v2/auth?"+new URLSearchParams(e).toString(),"Google Login",`scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=530,height=600,left=${(window.outerWidth-530)/2},top=${(window.outerHeight-950)/2}`)}function saveUIConfig(){localStorage.setItem("UIConfig",JSON.stringify(window.UIConfig))}function applyUIConfig(){window.UIConfig.hideSolvedTasks&&(window.UIConfig.hideSolvedTasks=!window.UIConfig.hideSolvedTasks,toggleSolvedTasks()),window.UIConfig.hideInfoPanel&&(window.UIConfig.hideInfoPanel=!window.UIConfig.hideInfoPanel,toggleInfoPanel()),document.querySelector("#theme-switch-checkbox").checked="dark"===window.UIConfig.theme?1:0}function setMenuEventListeners(){[...document.getElementsByClassName("accordion")].map(e=>{e.addEventListener("click",function(){const e=this.parentElement;if("menu-content"===e.id){for(let t of e.getElementsByClassName("panel"))t.classList.remove("active");for(let t of e.getElementsByClassName("accordion"))t.classList.remove("active")}this.classList.toggle("active");this.nextElementSibling.classList.toggle("active")})}),[...document.getElementsByClassName("eye-btn")].map(e=>{e.addEventListener("click",e=>{e.preventDefault(),toggleSolvedTasks()})})}function setEventListeners(){[...document.querySelectorAll(".db-description .sql")].map(e=>{e.addEventListener("dblclick",t=>{t.preventDefault(),window.sql_editor.session.insert(window.sql_editor.getCursorPosition(),` ${e.innerText} `),window.sql_editor.focus()})});document.querySelector("#theme-switch-checkbox").addEventListener("change",switchTheme,!1);const e=document.querySelector("a[target='ERDWindow']");e&&e.addEventListener("click",t=>{openRequestedTab(e.href),t.preventDefault()},!1)}setMenuEventListeners(),setEventListeners(),applyUIConfig(),document.getElementById("sql-code")&&(window.sql_editor=ace.edit("sql-code",{mode:"ace/mode/mysql",selectionStyle:"text",dragEnabled:!1,useWorker:!1}),window.sql_editor.setTheme("dark"===window.UIConfig.theme?"ace/theme/github_dark":"ace/theme/xcode"),window.sql_editor.setShowPrintMargin(!1),window.sql_editor.setOptions({enableBasicAutocompletion:!0})),window.onload=function(){scrollQuestionPanel(),document.addEventListener("keydown",function(e){e.ctrlKey&&"Enter"===e.key&&runQuery(lang,questionId)}),document.addEventListener("click",function(e){const t=document.getElementById("mobileMenuDropdown"),n=document.getElementById("mobileMenuToggle");t&&n&&!t.contains(e.target)&&!n.contains(e.target)&&t.classList.add("hidden")}),Ya&&Ya.Context||(document.getElementById("userInfo").style.display="block"),document.getElementById("yandexLogin")&&window.YaAuthSuggest&&window.YaAuthSuggest.init({client_id:"6a7ad9d0d23a496987255a596b83b9db",response_type:"code",redirect_uri:`${window.location.protocol}//${window.location.host}/login/yandex/?lang=${lang}&db=${db}&questionId=${questionId}`},`${window.location.protocol}//${window.location.host}/login/yandex/?lang=${lang}&db=${db}&questionId=${questionId}`,{view:"button",parentId:"yandexLogin",buttonSize:"xl",buttonView:"main",buttonTheme:"light",buttonBorderRadius:"6",buttonIcon:"ya"}).then(({handler:e})=>e()).catch(e=>alert("Обработка ошибки",e))};